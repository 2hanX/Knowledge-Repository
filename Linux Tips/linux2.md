### 手工 WordPress 网站备份以及恢复备份方法

最近需要对网站进行测试（联网更改网站配置风险大并且速度较慢，并且之前手贱还被搞宕机了几次 :(），因此我需要将WordPress网站上的全部内容扒下来，然后在我的kali主机本地服务上进行测试。本来认为这个过程挺简单的，执行起来却发现踩了不少坑，在此做个记录吧（以自己为例）

WordPress网站数据备份主要有两种类型：

1. 备份数据库（phpMyAdmin）
2. 使用WordPress自带导入导出功能备份网站内容

这两种方法都是在已有WordPress网站源码的基础上再进行配置更改，因此在此之前我们需要打包下载WordPress网站源码

1. 登录FTP服务到网站目录对所有源码进行打包：`tar -zpcf wp-backup.tar.gz wordpress/` [^5]
2. 传到kali的`/var/www/html`目录下并进行解包： `tar zxvf /wp-backup.tar.gz`

#### Q&A：

| 问题                       | 原因                                                         | 解决                                                         |
| -------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 访问时出现“连接数据库错误” | 1. 数据库连接相关参数存在问题：本地数据库不存在；数据库名，账号，登陆密码等不正确<br />2. 数据库前缀不一致，因为有可能数据库在迁移过程中，其前缀发生了变化<br />3. `wp_options`表出现问题<br />4. MySQL数据库服务没有启动 | 1. [创建MySQL本地数据库](https://blog.csdn.net/Doutd_y/article/details/88261626)[^2]<br />2. 在`wp-config.php`中添加代码：`define('WP_ALLOW_REPAIR', true);`然后直接访问后台`http://[your_domain]/wp-admin/`,根据提示进行恢复<br />3. 启动Apache和MySQL服务：`service mysql start`和`service apache2 start` |



### 步骤1：备份数据库

1. 备份数据库

   登录后台数据库phpMyAdmin→WordPress（自己的网站数据库）→导出→导出方式：自定义→输出：保存为文件：压缩：zip压缩，其他的选项基本不需要更改，直接点击执行即可，备份文件名为`wordpress.sql.zip`

2. 恢复数据库

   登录phpmyadmin，新建wordpress数据库→导入→Choose File

#### Q&A：

| 问题                                                         | 原因 | 解决                                                         |
| ------------------------------------------------------------ | ---- | ------------------------------------------------------------ |
| 如何删除wordpress数据库（控制台执行`drop database wordpress`提示“已禁用删除数据库语句”） |      | 使用mysql命令删除：<br />查看数据库：`show databases;`<br />删除数据库：`drop database wordpress;` |

### 步骤2：使用自带功能备份

1. 导出所有文章

   后台→工具→导出→选择“所有内容”[^1]→下载文件（文件扩展名.xml）

2. 导入所有文章

   后台→工具→导入→安装WordPress导入器→选择文件

3. 备份网站配置文件（不清楚怎样备份 :(，即使整个网站完全备份，但还是有些地方的设置丢失）

####   Q&A：

| 问题                      | 原因                               | 解决                                                         |
| ------------------------- | ---------------------------------- | ------------------------------------------------------------ |
| 安装导入器时需要填FTP凭证 | 1. 文件权限不够<br />2. 用户组不对 | 1. `chmod -R 755 wordpress/` [^3]<br />2. `chown -R www-data: wordpress/`[^4] |



---

[^1]: 包含了全部文章、页面、评论、自定义栏目、分类目录和标签
[^2]: 设置的数据库名，用户和密码需要与`wp-config.php`中的一致；查看所有用户：`select user,host from mysql.user;`
[^3]: 本地进行测试，不必担心权限开太大
[^4]: 如果不太确定www服务用户，可以查看`cat /etc/passwd`文件里的用户，我这里是`www-data`
[^5]: `wp-content`目录中包含了网站的主题、上传的各种多媒体文件，因此在以后做网站备份时只需将数据库和`wp-content`目录进行备份即可