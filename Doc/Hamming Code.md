### ox0 前言

海明码是广泛采用的一种有效的校验码，实际上是一种多重奇偶校验码。实现原理是在有效信息位[^1]中加入几个校验位[^2]形成海明码[^3]，并把海明码的每一个二进制位分配到几个奇偶校验组中，当某一位出错后，就会引起有关的几个校验位的值发生变化，这样就可以发现错位，并能指出错位的位置且能纠错

### 0x1 求解步骤

为了更好的解释在此举例：求`1010`的海明码

1. 确定海明码的位数

   设`n`为有效信息的位数，`k`为校验位的位数，则信息位`n`和校验位`k`应满足：
   $$
   n+k \leq 2^k-1
   $$
   （若要检测两位错，则需要在添加1位校验位，即`k+1`位）

   由以上信息得知

   - 校验码位数`k=3位`，`P3P2P1`：
     $$
     4+k \leq 2^k -1
     $$

   -   信息位（4位）：`D4D3D2D1=1010`

   -   海明码（7位）：`H7H6H5H4H3H2H1`[^4]

2. 确定校验码的分布

   规定校验位`Pi`在海明码==位号==为`2^i-1`的位置上，其余各位为信息位，因此：

   `P1`的海明位号为
   $$
   2^{i-1} = 2^0 = 1
   $$
   即`H1`为`P1`

   其他同理，接下来将信息位按原来的顺序插入，则海明码各位的分布如下：

   ```
   H7	H6	H5	H4	H3	H2	H1
   D4	D3	D2	P3	D1	P2	P1
   1	0	1	?	0	?	?
   ```

   接下来的工作就是求校验位`P1`，`P2`，`P3`的值

3. 分组形成校验关系

   规定：被校验数据位的海明==位号==等于校验该数据位的各校验位海明==位号之和==

   ```
   D1 在 H3（海明位号：3）上，那么由 P2P1（海明位号2+海明位号1）校验
   D2 在 H5（海明位号：5）上，那么由 P3P1（海明位号4+海明位号1）校验
   D3 在 H6（海明位号：6）上，那么由 P3P2（海明位号4+海明位号2）校验
   D4 在 H7（海明位号：7）上，那么由 P3P2P1（海明位号4+海明位号2+海明位号1）校验
   ```

   根据使用的校验位分组：

   ```
   P1（H1）：D1 D2 D4
   P2（H2）：D1 D3 D4
   P3（H4）：D2 D3 D4
   ```

   

4. 校验位取值

   规定：校验位`Pi`的值为第`i`组（有该校验位校验的数据位）所有位求==异或==

   ```
   P1 = D1 ⊕ D2 ⊕ D4 = 0 ⊕ 1 ⊕ 1 = 0
   P2 = D1 ⊕ D3 ⊕ D4 = 0 ⊕ 0 ⊕ 1 = 1
   P3 = D2 ⊕ D3 ⊕ D4 = 1 ⊕ 0 ⊕ 1 = 0
   ```

5. 结果

   所以，`1010`对应的海明码为 `1010010`

### 0x2 海明码的校验

每个校验组分别利用校验位和参与形成该校验位的信息位进行奇偶校验检查，就构成`k`个校验方程（监督位）

```
S1 = P1 ⊕ D1 ⊕ D2 ⊕ D4 = 0 ⊕ 0 ⊕ 1 ⊕ 1 = 0
S2 = P2 ⊕ D1 ⊕ D3 ⊕ D4 = 1 ⊕ 0 ⊕ 0 ⊕ 1 = 0
S3 = P3 ⊕ D2 ⊕ D3 ⊕ D4 = 0 ⊕ 1 ⊕ 0 ⊕ 1 = 0
```

若`S3S2S1`的值为`000`，则表示==无错==，否则表示出错。并且这个数（`S3S2S1`）就是错误位所在的==位号==，例如`S3S2S1=101(B)=5(D)`，说明第5位出错，直接取反就可以达到纠错的目的

### 0x3 讲解示例

采用一道CTF题作为海明码的校验讲解示例：

```
公司食堂最新出了一种小吃，叫鸡藕椒盐味汉堡，售价八块钱，为了促销，上面有一个验证码，输入后可以再换取一个汉堡。但是问题是每个验证码几乎都有错误,而且打印的时候倒了一下。小明买到了一个汉堡，准备还原验证码，因为一个吃不饱啊。验证码如下：1100 1010 0000 ,而且打印的时候倒了一下
```

根据题目可知验证码（海明码：12位）`1100 1010 0000`是有误的，需要我们纠正该海明码，也就是要进行海明码的校验。根据之前的求解步骤我们可以求出校验码的位数`k=4`，即有`P4P3P2P1`，而校验位占海明码中的位号分别是`8,4,2,1`
$$
n+k \leq 2^k-1 \\
12 \leq 2^k -1
$$
即海明码的分布如下：

```
H12	H11	H10	H9	H8	H7	H6	H5	H4	H3	H2	H1
D8	D7	D6	D5	P4	D4	D3	D2	P3	D1	P2	P1
1	1	0	0	1	0	1	0	0	0	0	0
```

接下来的工作也就是根据校验位进行检错，只需要再走一次流程即可

```
接收端校验位（需要经过计算得到）：
P1 = D1 ⊕ D2 ⊕ D4 ⊕ D5 ⊕ D7 = 0 ⊕ 0 ⊕ 0 ⊕ 0 ⊕ 1 = 1
P2 = D1 ⊕ D3 ⊕ D4 ⊕ D6 ⊕ D7 = 0 ⊕ 1 ⊕ 0 ⊕ 0 ⊕ 1 = 0
P3 = D2 ⊕ D3 ⊕ D4 ⊕ D8 = 0 ⊕ 1 ⊕ 0 ⊕ 1 = 0
P4 = D5 ⊕ D6 ⊕ D7 ⊕ D8 = 0 ⊕ 0 ⊕ 1 ⊕ 1 = 0
发送端校验位：
P1 = 0
P2 = 0
P3 = 0
P4 = 1
```

当监督位为`0000`时，说明接收方生成的校验位和收到的校验位相同，即正确无误，否则说明出错。这里监督位是`1001(B)=9(D)`,说明海明码第`9`位出错，对其进行取反纠错得到正确的验证码为`1101 1010 0000`



---

[^1]: 有效信息位，换句话说就是需要校验的原来的编码
[^2]: 校验位，也就是需要插入额外的二进制值
[^3]: 海明码，也就是原码经过校验的结果，其中包括原来的编码和校验码
[^4]: 按位数排序